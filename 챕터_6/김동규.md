# 챕터 6: 변경 가능한 데이터 구조를 가진 언어에서 불변성 유지하기

#스터디-쏙쏙들어오는함수형코딩

## 동작을 읽기, 쓰기 또는 둘 다로 분류하기

- 읽기
  - 데이터에서 정보를 가져옵니다.
  - 데이터를 바꾸지 않습니다.
- 쓰기
  - 데이터를 바꿉니다.
    어떤 경우에는 데이터를 쓰기 하면서 동시에 읽는 것도 가능하다.

## 카피-온-라이트 원칙 세 단계

1. 복사본 만들기
2. 복사본 변경하기
3. 복사본 리턴하기

카피-온-라이트 원칙이 적용 된 함수는 “읽기” 취급 된다. 데이터를 바꾸지 않았고 정보를 리턴했기 때문이다. 결국 카피-온-라이트는 쓰기를 읽기로 바꾼다.

## 쓰기를 하면서 읽기도 하는 동작은 어떻게 해야 할까요?

`.shift()` 메서드가 좋은 예제 이다. 값을 바꾸는 동시에 배열의 첫번째 항목을 리턴한다. 카피-온-라이트 방식으로 변경 한다면 아래와 같은 방법이 있다.

- 읽기와 쓰기 함수로 각각 분리한다.
- 함수에서 값을 두 개 리턴한다.

### 읽기와 쓰기 함수로 각각 분리하기

쓰기에서 읽기를 분리하고, 쓰기에 카피-온-라이트를 적용하여 읽기로 바꿉니다. 분리된 함수를 쓸 수 있기 때문에 좋은 접근 방법입니다. 원래 함께 써야하만 하지만, 선택해서 사용 가능합니다.

### 함수에서 값을 두 개 리턴한다.

새로운 함수로 감싼 후, 읽기와 쓰기를 함께하는 함수를 읽기만 하는 함수로 바꿉니다.

## 불변 데이터 구조를 읽는 것은 계산입니다

- 변경 가능한 데이터를 읽는 것은 액션입니다.
- 쓰기는 데이터를 변경 가능한 구조로 만듭니다.
- 어떤 데이터에 쓰기가 없다면 데이터는 변경 불가능한 데이터입니다.
- 불변 데이터 구조를 읽는 것은 계산입니다.
- 쓰기를 읽기로 바꾸면 코드에 계산이 많아집니다.

## 불변 데이터 구조는 충분히 빠릅니다.

불변 데이터 구조는 메모리를 더 많이 쓰고 느립니다. 하지만 일반 애플리케이션에 쓰기 충분히 빠른점도 있습니다. 하지만 몇 가지 논점은 있습니다.

- 언제든 최적화할 수 있습니다.
- 가비지 콜렉터는 매우 빠릅니다.
- 생각보다 많이 복사하지 않습니다.
- 함수형 프로그래밍 언어에는 빠른 구현체가 있습니다.

## 객체에 대한 카피-온-라이트

배열과 같은 단계로 구현할 수 있습니다. 다만 `slice` 가 없기때문에 `assign` 메서드를 사용해서 복사할 수 있습니다.

## 얕은 복사와 구조적 공유를 그림으로 알아보기

```생각 & 의견
배열을 복사하고 원하는 객체를 찾아 복사하고 데이터 수정후 다시 리턴
결국 바뀐것 1개 안바뀐 것 2개
각 배열의 안바뀐 객체 2개는 같은 메모리 데이터를 보고 있으니
이게 구조적 공유라는건가요??

도움.... 이해 하신분??!
```

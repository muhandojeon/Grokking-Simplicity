# 신뢰할 수 없는 코드를 쓰면서 불변성 지키기
* 우리가 만든 코드는 신뢰할 수 없는 코드와 상호작용해야 한다
  + 카피 온 라이트를 이용해 불변성이 지켜지는 '안전지대'가 있지만
  + 레거시 코드, 써드 파티 코드들과 상호작용해야 할 때가 있다

* 안전지대 밖으로 나가고 들어오는 데이터는 잠재적으로 바뀔 수 있다
  

## 방어적 복사를 통해 불변성을 지킬 수 있다

1. 데이터가 안전한 코드에서 나갈 때 복사하기
2. 안전한 코드로 데이터가 들어올 때 복사하기

* 이는 깊은 복사를 해야 함

## 방어적 복사는 익숙할 수 있음

* 웹 기반 API는 암묵적으로 방어적 복사를 함
  + 직렬화된 JSON 데이터 등

* 모듈이 서로 통신하기 위해 방어적 복사를 구현했다면 '비공유 아키텍처'라고 함
  + 모듈이 어떤 데이터의 참조도 공유하고 있지 않기 때문

## 깊은 복사는 얕은 복사보다 비쌈

* 모든 것을 복사하기 때문에

## 결론

* 카피 온 라이트와 다르게 방어적 복사는 불변성 원칙을 구현하지 않은 코드로부터 데이터를 보호해 줌
* 방어적 복사는 신뢰할 수 없는 코드와 함께 사용할 때만 사용
